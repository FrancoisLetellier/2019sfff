var waitingVOListTable,myVoListTable,otherVoListTable,leavingVoListTable,badVoListTable,securityListTable,rbCertListTable,voserial,tabErrorDiv={waitingVOListTable:"errorDivWaiting",myVoListTable:"errorDivMyVO",otherVoListTable:"errorDivOther",leavingVoListTable:"errorDivLeaving",badVoListTable:"errorDivBadVo",securityListTable:"errorDivSecurity",rbCertListTable:"errorDivRbCert"};function format(e){return'<div class="card"><h3>'+e.name+'</h3><h3>General Information</h3><table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>VO name: </td><td>'+e.name+"</td></tr></table></div>"}function setUpFilters(){console.log("setUpFilters"),$(".filters .search").each(function(){var e=$(this).text();$(this).html('<input type="text" placeholder="Search '+e+'" />')})}function setUpAup(){$("#vo_VoHeader_aupFile_aupFile").change(function(){var e=$("#vo_VoHeader_aupFile_aupFile").val();if(e){var a=$("#vo_VoHeader_name").val(),t=new Date,o=t.getUTCFullYear()+pad2(t.getMonth()+1)+pad2(t.getDate()),l=getExtensionFile(e);$("#vo_VoHeader_aupFile_name").val(a+"-AcceptableUsePolicy-"+o+"-"+t.getTime()+"."+l)}}),0==$("#fileError").find("ul").length&&$("#fileError").hide(),$("#aup_text_block").on("click",function(e){$(this).addClass("d-block")})}function buildVOTables(){0!=$("#waitingVOListTable").length&&(waitingVOListTable=$("#waitingVOListTable").DataTable({columns:[{className:"details-control",orderable:!1},{data:"Name"},{data:"Status"},{data:"Creation"},{data:"Scope"},{data:"Discipline",orderable:!1},{data:"Need VOMS Support (0))"},{data:"VOMS (1)"},{data:"VO (2)"},{data:"VO SU (3)"},{data:"Action",orderable:!1,searchable:!1},{data:"serial",visible:!1,orderable:!1,searchable:!1}],order:[[3,"desc"]],dom:'<"top"B><"pull-right"l><"bottom"rtip><"clear">',searchable:!1,buttons:[{extend:"colvis",columns:[0,1,2,3,4,5,6,7,8,9,10]},{className:"exportButton",extend:"collection",text:"Export",buttons:["copy","excel","csv","pdf","print"]}]}).columns.adjust().draw()),0!=$("#leavingVoListTable").length&&(leavingVoListTable=$("#leavingVoListTable").DataTable({lengthMenu:[[10,25,50,100,500,-1],[10,25,50,100,500,"All"]],columns:[{className:"details-control",orderable:!1},{data:"name"},{data:"status"},{data:"discipline",orderable:!1},{data:"scope"},{data:"middleware(s)",orderable:!1},{data:"Active Users"},{data:"Total Users"},{data:"Actions",orderable:!1,searchable:!1},{data:"serial",orderable:!1,searchable:!1}],order:[[1,"asc"]],dom:'<"top"B><"pull-right"l><"bottom"rtip><"clear">',searchable:!1,buttons:[{extend:"colvis",columns:[0,1,2,3,4,5,6]},{className:"exportButtonOther",extend:"collection",text:"Export",buttons:["copy","excel","csv","pdf","print"]}]}).columns.adjust().draw()),0!=$("#myVoListTable").length&&(myVoListTable=$("#myVoListTable").DataTable({columns:[{className:"details-control",orderable:!1},{data:"VO"},{data:"Last update"},{data:"Last validation date"},{data:"Last email sending"},{data:"validation"},{data:"Action",orderable:!1,searchable:!1},{data:"serial",orderable:!1,searchable:!1},{data:"status",orderable:!1,searchable:!1}],order:[[1,"asc"]],dom:'<"top"B><"pull-right"l><"bottom"rtip><"clear">',searchable:!1,buttons:[{extend:"colvis",columns:[0,1,2,3,4,5,6]},{className:"exportButton",extend:"collection",text:"Export",buttons:["copy","excel","csv","pdf","print"]}]}).columns.adjust().draw()),0!=$("#otherVoListTable").length&&(otherVoListTable=$("#otherVoListTable").DataTable({columnDefs:[{type:"num",targets:[5,6]},{width:100,targets:0}],lengthMenu:[[10,25,50,100,500,-1],[10,25,50,100,500,"All"]],columns:[{className:"details-control",orderable:!1},{data:"name"},{data:"discipline",orderable:!1},{data:"scope"},{data:"middleware(s)",orderable:!1},{data:"Active Users"},{data:"Total Users"},{data:"Actions",orderable:!1,searchable:!1},{data:"serial",orderable:!1,searchable:!1},{data:"status",orderable:!1,searchable:!1}],order:[[1,"asc"]],dom:'<"top pb-2"B><"pb-2 float-right"fl><"bottom"rtip><"clear">',stateSave:!0,searchable:!0,buttons:[{extend:"colvis",columnDefs:[{className:"text-info",targets:1}],className:"bg-primary",columns:[0,1,2,3,4,5,6,7]},{extend:"collection",text:"Export",className:"exportButtonOther  bg-primary",buttons:["copy","excel","csv","pdf","print"]}]}).columns.adjust().draw())}function buildInvalidVOTable(){badVoListTable=$("#badVoListTable").DataTable({lengthMenu:[[10,25,50,100,500,-1],[10,25,50,100,500,"All"]],pageLength:50,columns:[{data:"Vo name"},{data:"serial"},{data:"Admins"},{data:"AUP"},{data:"Description"},{data:"Homepage URL"},{data:"User Support"},{data:"Nb Voms Server"},{data:"Voms Users"},{data:"Score(%)"},{data:"Details",orderable:!1},{data:"Last report"},{data:"Submit report",orderable:!1}],order:[[1,"asc"]],dom:'<"top"B><"pull-right"l><"bottom"rtip><"clear">',searchable:!1,buttons:["colvis",{className:"exportButtonOther",extend:"collection",text:"Export",buttons:["copy","excel","csv","pdf","print"]}]})}function buildSecurityTable(){securityListTable=$("#securityListTable").DataTable({pageLength:50,columns:[{data:"Vo Name"},{data:"Security Contacts"},{data:"Contacts Managers"},{data:"Action",orderable:!1,searchable:!1},{data:"serial",orderable:!1,searchable:!1}],order:[[0,"asc"]],dom:'<"top"B>fl<"bottom"rtip><"clear">',searchable:!1,buttons:[{extend:"colvis",columns:":not(:last-child)"},{className:"exportButtonOther",extend:"collection",text:"Export",buttons:["copy","excel","csv","pdf","print"]}]})}function applySearch(){0!=$("#myVoListTable").length&&myVoListTable.columns().eq(0).each(function(){var e=this;$("#myVoListTable .filters th  input",$(".myVoListTable thead")[1]).on("keyup change",function(){e.search(this.value).draw()})}),0!=$("#leavingVoListTable").length&&null!=leavingVoListTable.columns().eq(0)&&leavingVoListTable.columns().eq(0).each(function(){var e=this;$("#leavingVoListTable .filters th  input",$(".leavingVoListTable thead")[1]).on("keyup change",function(){e.search(this.value).draw()})}),0!=$("#otherVoListTable").length&&otherVoListTable.columns().eq(0).each(function(){var e=this;$("#otherVoListTable .filters th  input",$(".otherVoListTable thead")[1]).on("keyup change",function(){e.search(this.value).draw()})})}function constructExportButtons(e,a){$(".exportButtonOther").click(function(){0==$(".buttons-xml-list").length&&$(".dt-button-collection").append("<a class='dt-button dropdown-item buttons-xml-list buttons-html5' tabindex='0' aria-controls='voListOtherTable' href='"+a+"' title='download the list of the VO in a xml format'>Vo List XML</a><a class='dt-button dropdown-item  buttons-xml-full buttons-html5' tabindex='0' aria-controls='voListOtherTable' href='"+e+"' title='download the VO ID cards information in a xml format'>Vo Full XML</a>")})}function getVODetails(a,e,t){var o,l=$(a).closest("tr");o=-1!=t.indexOf("other")?otherVoListTable.row(l):-1!=t.indexOf("myVo")?myVoListTable.row(l):-1!=t.indexOf("leaving")?leavingVoListTable.row(l):-1!=t.indexOf("bad")?badVoListTable.row(l):-1!=t.indexOf("security")?securityListTable.row(l):waitingVOListTable.row(l),voserial=o.data().serial,$.ajax({type:"POST",data:{serial:voserial},url:e,async:!1,beforeSend:function(){$(a).html("<span class='loader-little'></span>")},complete:function(e){$(a).html("<span class='btn btn-sm btn-light border border-secondary'><span class='fa fa-search-plus'></span></span>"),$("body").append(e.responseText),$("#modalVo"+o.data().serial).modal()},error:function(e){$(a).html("<span class='btn btn-sm btn-light border border-secondary'><span class='fa fa-search-plus'></span></span>"),$("#"+tabErrorDiv[t]).html(e.status+" : "+e.responseText),$("#"+tabErrorDiv[t]).show()}})}function getVomsDetail(a,e,t,o){var l=$(a).closest("tr"),s=t.replace(/[^a-z0-9\s]/gi,"");null==voserial&&(voserial=$("#vo_VoHeader_serial").val()),$("#vomsDetail"+voserial+s).length&&$("#vomsDetail"+voserial+s).is(":visible")?($("#vomsDetail"+voserial+s).slideUp(),$(a).html("<span class='btn btn-sm btn-light'><span class='fa fa-plus'></span></span>")):($("#vomsDetailError").remove(),$.ajax({type:"POST",data:{serial:voserial,host:t,colspan:o},url:e,async:!1,beforeSend:function(){$(a).html("<span class='loader-little'></span>")},complete:function(e){$(a).html("<span class='btn btn-sm btn-light'><span class='fa fa-minus'></span></span>"),$(e.responseText).insertAfter(l),0!=$("#vomsDetail"+voserial+s).length?$("#vomsDetail"+voserial+s).slideDown():$("#vomsDetailError").slideDown()},error:function(e){$("#errorDivVoms > div").html(e.status+" : "+e.responseText),$("#errorDivVoms > div").show()}}))}function validateVO(e,a){$.ajax({type:"POST",data:{serial:e},dataType:"json",url:a,async:!1,beforeSend:function(){$("#modalVoConfirm .modal-body").html("<span class='loader-middle'></span>")},success:function(e){1==e.isSuccess?($("#modalVoConfirm .modal-body").html(e.res),setTimeout(function(){location.reload()},1e4)):($("#modalVoConfirm").modal("hide"),$("#errorDivMyVO > div").html(e.res),$("#errorDivMyVO > div").show())},error:function(e){$("#modalVoConfirm").modal("hide"),$("#errorDivMyVO > div").html(e.status+" : "+e.responseText),$("#errorDivMyVO > div").show()}})}function updateScope(a,e,t){$.ajax({type:"POST",dataType:"json",data:{serial:t,scopeId:$(a).val()},url:e,async:!1,beforeSend:function(){$(a).parents("td").append("&nbsp;<span class='pull-right loader-little'></span>")},success:function(e){$(a).parents("td").find(".loader-little").remove(),$(a).parents("td").children("span").remove(),$(a).parents("td").append("<span style='margin-top:2%' class='badge badge-success pull-left'>"+e.status+"</span>")},error:function(e){$(a).parents("td").find(".loader-little").remove(),$(a).parents("td").children("span").remove(),$(a).parents("td").append("<span style='margin-top:2%' class='badge badge-danger pull-left'>"+e.status+"</span>")}})}function showLoaderOnVoAction(){$(".voAction").on("click",function(){$(".loader-wrapper").show(),$(".loader-wrapper .loader").show()})}function loadSynoptic(e,a){$("#collapseVoValidity").on("shown.bs.collapse",function(){0==$("#badVoListTable").length&&$.ajax({type:"POST",url:e,async:!1,beforeSend:function(){$("#voValidityBody").append("<span class='loader-middle'></span>")},error:function(e){$("#errorDivValidity").html('<div class="alert alert-danger"> '+e.responseText+"</div>")},success:function(e){$("#voValidityBody").children(".loader-middle").remove(),$("#errorDivValidity").empty()},complete:function(e){$("#voValidityBody").append(e.responseText),buildInvalidVOTable()}})})}function searchDN(e){if($("#user_tracking_DN")[0].checkValidity()){$("#errorDN").remove(),$("#modalDN").modal("show");var a=$("#user_tracking_DN").val(),t="";$.ajax({type:"POST",dataType:"json",url:e,data:{q:a},beforeSend:function(){$("#modalDN .modal-body .loader-middle").show()},error:function(e){$("#modalDN .modal-body").html('<div class="alert alert-danger"> '+e.responseText+"</div>")},success:function(e){$.each(e,function(e,a){t+='<label class="radio">',t+="<input type='radio' name='optionsRadios' id='"+a+"' value='"+a+"' />",t+=a,t+="</label>"}),$("#modalDN .modal-body").fadeIn(1e3).html(t)}})}else $("#errorDN").remove(),$("#user_tracking_DN").parents(".form-group").append("<p id='errorDN' style='color:#cd0a0a; font-weight: bold'>DN field is empty</p>")}function selectDN(e){checkVo($("input[type=radio]:checked").val()),$("#user_tracking_email").removeAttr("disabled"),$("#user_tracking_subject").removeAttr("disabled"),$("#user_tracking_body").removeAttr("disabled"),$("#user_tracking_send").removeAttr("disabled"),$("#email_securityOfficier").removeClass("alert-info").removeClass("alert-danger").html("");var a=$("#user_tracking_DN").val(),t=$("#user_tracking_vo").val();$.ajax({type:"POST",url:e,dataType:"json",data:{DN:a,VO:t},error:function(e){$("#email_securityOfficier").show().removeClass("alert-info").addClass("alert-danger").html(e.responseText)},success:function(e){$("#email_securityOfficier").show().removeClass("alert-danger").addClass("alert-info").html(e)}})}function checkVo(e){var a=e.indexOf("VO"),t=e.substring(a+4);$("#user_tracking_vo").val(t);a=e.indexOf("CN:");var o=e.substring(0,a);$("#user_tracking_DN").val(o)}function showHideUseSubProxiesMessage(e){$(e).is(":checked")?$("#subProxiesInfo").show():$("#subProxiesInfo").hide()}function clearRbCertModal(){0<=$("#modalVoAddCert .modal-title span:nth-child(2)").text().indexOf("Edit")&&($("#modalVoAddCert .modal-title span:nth-child(2)").text("Add Robot Certificate"),$("#modalVoAddCert #formContactEGI")[0].reset(),$("#subProxiesInfo").hide())}$(document).ready(function(){$(".panel-collapse").on("shown.bs.collapse",function(e){var a=$(e.currentTarget).find(".card-body").find(".table")[0].id;$("#"+a).DataTable().columns.adjust().responsive.recalc()})});